(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2261:(e,t,a)=>{Promise.resolve().then(a.bind(a,4137))},4137:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var s=a(5155),l=a(2115),r=a(5695),n=a(9039);let d=e=>{let{rpm:t,maxRpm:a=8e3,yellowZone:r=7e3,redZone:d=7500,speed:c,gearNumber:i,width:o=300,height:m=300,startAngle:h=.5*Math.PI,endAngle:u=2*Math.PI,nextGearRpm:x}=e,p=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!p.current)return;let e=n.Ltv(p.current);e.selectAll("*").remove();let s=o/2,l=m/2,c=Math.min(o,m)/2-20,b=Math.min(o,m)/300,f=Math.max(8,Math.round(12*b)),g=Math.max(16,Math.round(24*b)),j=Math.max(18,Math.round(28*b)),v=Math.max(2,Math.round(3*b)),N=Math.max(1,Math.round(2*b)),y=Math.max(6,Math.round(10*b)),w=Math.max(4,Math.round(6*b)),M=.5*Math.PI,C=n.m4Y().domain([0,a]).range([h,u]),k=n.JLW().innerRadius(c-30*b).outerRadius(c).startAngle(h+M).endAngle(u+M);if(e.append("path").attr("d",k).attr("transform","translate(".concat(s,", ").concat(l,")")).attr("fill","#e0e0e0"),r<a){let t=n.JLW().innerRadius(c-30*b).outerRadius(c).startAngle(C(r)+M).endAngle(C(Math.min(d,a))+M);e.append("path").attr("d",t).attr("transform","translate(".concat(s,", ").concat(l,")")).attr("fill","#FFD700")}if(d<a){let t=n.JLW().innerRadius(c-30*b).outerRadius(c).startAngle(C(d)+M).endAngle(C(a)+M);e.append("path").attr("d",t).attr("transform","translate(".concat(s,", ").concat(l,")")).attr("fill","#FF0000")}let R=a<=1e4?1e3:2e3;n.y17(0,a+1,R).forEach(t=>{let a=C(t),r=s+(c-30*b)*Math.cos(a),n=l+(c-30*b)*Math.sin(a),d=s+(c-10*b)*Math.cos(a),i=l+(c-10*b)*Math.sin(a);e.append("line").attr("x1",r).attr("y1",n).attr("x2",d).attr("y2",i).attr("stroke","black").attr("stroke-width",N);let o=s+(c-45*b)*Math.cos(a),m=l+(c-45*b)*Math.sin(a);e.append("text").attr("x",o).attr("y",m).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("font-size","".concat(f,"px")).text(t/1e3)});let S=C(Math.min(t,a)),I=c-8*b,P=s+I*Math.cos(S),A=l+I*Math.sin(S),E=S+Math.PI/2,F=S-Math.PI/2,L=s+v*Math.cos(E),Z=l+v*Math.sin(E),z=s+v*Math.cos(F),D=l+v*Math.sin(F);if(e.append("path").attr("d","M ".concat(L," ").concat(Z," L ").concat(P," ").concat(A," L ").concat(z," ").concat(D," Z")).attr("fill","red").attr("stroke","none"),void 0!==x){let t=C(Math.min(x,a)),r=s+I*Math.cos(t),n=l+I*Math.sin(t),d=t+Math.PI/2,c=t-Math.PI/2,i=s+v*Math.cos(d),o=l+v*Math.sin(d),m=s+v*Math.cos(c),h=l+v*Math.sin(c);e.append("path").attr("d","M ".concat(i," ").concat(o," L ").concat(r," ").concat(n," L ").concat(m," ").concat(h," Z")).attr("fill","#0066cc").attr("stroke","none")}e.append("circle").attr("cx",s).attr("cy",l).attr("r",y).attr("fill","#333"),e.append("circle").attr("cx",s).attr("cy",l).attr("r",w).attr("fill","#666");let O=l+150*b,_=l-120*b,U=t>=d;e.append("text").attr("x",s).attr("y",O).attr("text-anchor","middle").attr("font-size","".concat(g,"px")).attr("font-weight","bold").attr("fill",U?"#FF0000":"black").text("".concat(Math.round(t)," RPM")),e.append("text").attr("x",s).attr("y",_).attr("text-anchor","middle").attr("font-size","".concat(j,"px")).attr("font-weight","bold").text("".concat(x?"".concat(i,"-").concat(Number(i)+1):i))},[t,a,r,d,c,i,o,m,h,u,x]),(0,s.jsx)("div",{className:"tachometer-container",children:(0,s.jsx)("svg",{ref:p,width:o,height:m})})},c=e=>{let{onSelect:t,presets:a=[]}=e;return 0===a.length?(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"プリセット選択"}),(0,s.jsx)("p",{children:"プリセットを読み込み中..."})]}):(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"プリセット選択"}),(0,s.jsx)("div",{className:"grid gap-4",children:a.map(e=>(0,s.jsxs)("button",{onClick:()=>t({modelCode:e.modelCode,description:e.description,url:"/presets/".concat(e.modelCode,".yaml")}),className:"flex flex-col items-start p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsx)("span",{className:"font-medium",children:e.modelCode}),(0,s.jsx)("span",{className:"text-gray-600",children:e.description})]},e.modelCode))})]})};function i(e){let t=function(e){let t=e.match(/^(\d+)\/(\d+)\/R(\d+)$/);if(!t)return null;let a=parseInt(t[1],10);return{width:a,aspectRatio:parseInt(t[2],10),rimDiameter:parseInt(t[3],10)}}(e);if(!t)return .65;let{width:a,aspectRatio:s,rimDiameter:l}=t;return(25.4*l+a*s/100*2)/1e3}function o(e){return Math.PI*i(e)}var m=a(534);let h=()=>"/taco-web";async function u(){try{let e=h(),t=await fetch("".concat(e,"/presets/index.yaml"));if(!t.ok)throw Error("プリセットインデックスの読み込みに失敗しました: ".concat(t.statusText));let a=await t.text();return m.Ay.load(a).presets||[]}catch(e){return console.error("プリセットの読み込みに失敗しました:",e),[]}}async function x(e){return(await u()).find(t=>t.modelCode===e)}async function p(e){try{let t=h(),a=await fetch("".concat(t,"/presets/").concat(e,".yaml"));if(!a.ok)throw Error("プリセット ".concat(e," の読み込みに失敗しました: ").concat(a.statusText));let s=await a.text();return m.Ay.load(s)}catch(t){return console.error("プリセット ".concat(e," の詳細の読み込みに失敗しました:"),t),null}}let b=[];u().then(e=>{b.length=0,e.forEach(e=>{b.push({modelCode:e.modelCode,description:e.description,url:"/presets/".concat(e.modelCode,".yaml")})})}).catch(e=>{console.error("プリセットの初期化に失敗しました:",e)});let f=async e=>{if(!await x(e))throw Error("プリセット ".concat(e," が見つかりません"));return p(e)},g=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),[a,n]=(0,l.useState)("ND5RC"),[h,x]=(0,l.useState)("マツダ ロードスター（ND 1.5）"),[p,b]=(0,l.useState)([]),g=.5*Math.PI,j=2*Math.PI,[v,N]=(0,l.useState)({first:5.087,second:2.991,third:2.035,fourth:1.594,fifth:1.286,sixth:1,seventh:0,eighth:0,ninth:0,reverse:4.696}),[y,w]=(0,l.useState)(2.866),[M,C]=(0,l.useState)("195/50/R16"),[k,R]=(0,l.useState)(7e3),[S,I]=(0,l.useState)(7500),[P,A]=(0,l.useState)(8e3),[E,F]=(0,l.useState)(60),[L,Z]=(0,l.useState)(1),[z,D]=(0,l.useState)(g),[O,_]=(0,l.useState)(j),[U,J]=(0,l.useState)(3),[W,T]=(0,l.useState)({width:300,height:300}),B=(0,l.useRef)(null),[H,q]=(0,l.useState)([]),G=(100*i(M)).toFixed(1),Y=(100*o(M)).toFixed(1),$=(1e3/o(M)).toFixed(1);(0,l.useEffect)(()=>{let e=[v.first,v.second,v.third,v.fourth,v.fifth,v.sixth,v.seventh,v.eighth,v.ninth,v.reverse].filter(e=>e>0);q(e.map(e=>{var t,a,s;return t=E,a=e,s=y,Math.round(t/3.6/(Math.PI*i(M))*60*a*s)}))},[E,v,y,M]),(0,l.useEffect)(()=>{if(!B.current)return;let e=()=>{var e;let t=null===(e=B.current)||void 0===e?void 0:e.querySelectorAll(".tachometer-item");if(!t||0===t.length)return;let a=t[0],s=a.clientWidth;a.clientHeight;let l=Math.max(s-32,100),r=Math.max(l,100);T({width:l,height:r})};e();let t=new ResizeObserver(()=>{e()});return t.observe(B.current),()=>{t.disconnect()}},[H.length,U]);let K=(e,t)=>{let a=parseFloat(t)||0;N(t=>({...t,[e]:a}))};Object.values(v).filter((e,t)=>e>0&&t<9).length;let Q=async t=>{try{let a=await f(t.modelCode);console.log(JSON.stringify(a,null,2)),a.modelCode&&n(a.modelCode),a.description&&x(a.description),a.gearRatios&&N(a.gearRatios),a.finalDriveRatio&&w(a.finalDriveRatio),a.tireSize&&C(a.tireSize),a.yellowZone&&R(a.yellowZone),a.redZone&&I(a.redZone),a.maxRpm&&A(a.maxRpm),a.startAngle&&D(a.startAngle),a.endAngle&&_(a.endAngle),a.columnsCount&&J(a.columnsCount);let s=new URLSearchParams(window.location.search);s.set("preset",t.modelCode),e.push("?".concat(s.toString()))}catch(e){console.error("プリセットの読み込みに失敗しました:",e),alert("プリセットの読み込みに失敗しました。")}};return(0,l.useEffect)(()=>{(async()=>{try{let e=await u();b(e)}catch(e){console.error("プリセット一覧の読み込みに失敗しました:",e)}})()},[]),(0,l.useEffect)(()=>{let e=t.get("preset");e&&Q({modelCode:e,description:"",url:""})},[]),(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"ギア比タコメーターアプリ"}),(0,s.jsx)(c,{onSelect:Q,presets:p}),(0,s.jsxs)("div",{className:"mb-4 flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>{let e=(0,m.Bh)({modelCode:a,description:h,gearRatios:v,finalDriveRatio:y,tireSize:M,yellowZone:k,redZone:S,maxRpm:P,startAngle:z,endAngle:O,columnsCount:U}),t=new Blob([e],{type:"text/yaml"}),s=URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download="".concat(a,".yaml"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)},className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"設定を保存"}),(0,s.jsxs)("label",{className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded cursor-pointer",children:["設定を読み込む",(0,s.jsx)("input",{type:"file",accept:".yaml,.yml",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let s=new FileReader;s.onload=e=>{try{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result,s=(0,m.Hh)(a);console.debug(s),N(s.gearRatios),w(s.finalDriveRatio),C(s.tireSize),R(s.yellowZone),I(s.redZone),A(s.maxRpm),D(s.startAngle),_(s.endAngle),J(s.columnsCount)}catch(e){console.error("設定ファイルの読み込みに失敗しました:",e),alert("設定ファイルの読み込みに失敗しました。ファイル形式を確認してください。")}},s.readAsText(a)},className:"hidden"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:h}),(0,s.jsxs)("p",{className:"text-gray-600",children:["型式: ",a]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["速度: ",E," km/h"]}),(0,s.jsx)("input",{type:"range",min:"0",max:"300",value:E,onChange:e=>{F(parseInt(e.target.value)||0)},className:"w-full"})]})}),(0,s.jsx)("div",{ref:B,className:"grid ".concat((()=>{switch(U){case 1:return"grid-cols-1";case 2:return"grid-cols-2";case 3:default:return"grid-cols-3";case 4:return"grid-cols-4";case 5:return"grid-cols-5";case 6:return"grid-cols-6"}})()," gap-4"),children:H.map((e,t)=>{if(t===H.length-1)return null;let a=H[t+1];return a>e&&(a=void 0),(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-md tachometer-item",children:(0,s.jsx)(d,{rpm:e,maxRpm:P,yellowZone:k,redZone:S,speed:E,gearNumber:t+1,nextGearRpm:a,width:W.width,height:W.height,startAngle:z,endAngle:O})},t)})})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ギア比設定"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第1速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.first||"",onChange:e=>K("first",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第2速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.second||"",onChange:e=>K("second",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第3速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.third||"",onChange:e=>K("third",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第4速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.fourth||"",onChange:e=>K("fourth",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第5速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.fifth||"",onChange:e=>K("fifth",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第6速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.sixth||"",onChange:e=>K("sixth",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第7速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.seventh||"",onChange:e=>K("seventh",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第8速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.eighth||"",onChange:e=>K("eighth",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"第9速"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.ninth||"",onChange:e=>K("ninth",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"後退 (R)"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:v.reverse||"",onChange:e=>K("reverse",e.target.value),className:"w-full px-3 py-2 border rounded-md"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"最終減速比"}),(0,s.jsx)("input",{type:"number",step:"0.001",value:y||"",onChange:e=>{w(parseFloat(e.target.value)||0)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"タイヤサイズ (例: 195/50/R16)"}),(0,s.jsx)("input",{type:"text",value:M,onChange:e=>{C(e.target.value)},className:"w-full px-3 py-2 border rounded-md",placeholder:"195/50/R16"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"開始角度 (π\xd7)"}),(0,s.jsx)("input",{type:"number",step:"0.1",value:z/Math.PI,onChange:e=>{D((parseFloat(e.target.value)||0)*Math.PI)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"終了角度 (π\xd7)"}),(0,s.jsx)("input",{type:"number",step:"0.1",value:O/Math.PI,onChange:e=>{_((parseFloat(e.target.value)||0)*Math.PI)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"イエローゾーン開始 (rpm)"}),(0,s.jsx)("input",{type:"number",step:"100",value:k||"",onChange:e=>{R(parseInt(e.target.value)||0)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"レッドゾーン開始 (rpm)"}),(0,s.jsx)("input",{type:"number",step:"100",value:S||"",onChange:e=>{I(parseInt(e.target.value)||0)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"最大RPM"}),(0,s.jsx)("input",{type:"number",step:"100",value:P||"",onChange:e=>{A(parseInt(e.target.value)||0)},className:"w-full px-3 py-2 border rounded-md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"タコメーター列数 (1-6)"}),(0,s.jsx)("input",{type:"number",min:"1",max:"6",value:U,onChange:e=>{J(Math.max(1,Math.min(6,parseInt(e.target.value)||1)))},className:"w-full px-3 py-2 border rounded-md"})]})]}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"タイヤ情報と計算式"}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"現在のタイヤサイズ:"})," ",M]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"タイヤ外径:"})," ",G," cm"]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"タイヤ外周:"})," ",Y," cm"]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"1km走行あたりの回転数:"})," ",$," 回転"]}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("span",{className:"font-medium",children:"タイヤ外径の計算式:"}),(0,s.jsxs)("div",{className:"mt-1 text-sm bg-gray-50 p-2 rounded",children:["タイヤ外径 = リム径(インチ) \xd7 25.4 + 2 \xd7 (タイヤ幅(mm) \xd7 扁平率 \xf7 100)",(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-gray-600",children:["例: ",M," の場合"]}),(0,s.jsx)("br",{}),"リム径 = 16インチ, タイヤ幅 = 195mm, 扁平率 = 50%",(0,s.jsx)("br",{}),"タイヤ外径 = 16 \xd7 25.4 + 2 \xd7 (195 \xd7 50 \xf7 100) = ",G," cm"]})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"タイヤ外周の計算式:"}),(0,s.jsxs)("div",{className:"mt-1 text-sm bg-gray-50 p-2 rounded",children:["タイヤ外周 = π \xd7 タイヤ外径",(0,s.jsx)("br",{}),(0,s.jsxs)("span",{className:"text-gray-600",children:["例: ",M," の場合"]}),(0,s.jsx)("br",{}),"タイヤ外周 = π \xd7 ",G," cm = ",Y," cm"]})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"RPM計算式:"}),(0,s.jsx)("div",{className:"mt-1 text-sm bg-gray-50 p-2 rounded",children:"RPM = (速度[km/h] \xd7 ギア比 \xd7 最終減速比 \xd7 60) \xf7 (タイヤ外周[m] \xd7 3.6)"})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"現在の設定:"})," 最終減速比 = ",y]})]})]})]})};function j(){return(0,s.jsx)("main",{className:"min-h-screen py-8",children:(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(g,{})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[438,441,684,358],()=>t(2261)),_N_E=e.O()}]);